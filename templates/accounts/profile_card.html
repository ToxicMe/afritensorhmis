<div class="border rounded-md p-6 shadow-sm bg-white max-w-4xl mx-auto">
  <!-- Patient Basic Info -->
  <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
    <div class="sm:order-last sm:shrink-0">
      <img 
        src="https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_1280.png" 
        alt="{{ patient.patient_name }}" 
        class="w-20 h-20 rounded-full object-cover"
      />
    </div>
    <div class="flex-1">
      <h2 class="text-2xl font-bold text-gray-900">{{ patient.patient_name }}</h2>
      <p class="text-sm text-gray-600">
        Age: 
        {% if patient.age %}
          {{ patient.age }}
        {% else %}
          N/A
        {% endif %}
        | Sex: {{ patient.gender|title }} <br>
        Registration Station: {{ visit.hospital.name }}
      </p>
    </div>
  </div>

  <!-- Current Visit Triage -->
  <div class="mt-4 border-t pt-4">
    <h3 class="font-semibold text-gray-800">Current Visit (Triage)</h3>
    {% if triage %}
      <ul class="mt-2 text-gray-700 text-sm space-y-1">
        <li>BP: {% if triage.bp_sys and triage.bp_dia %} {{ triage.bp_sys }}/{{ triage.bp_dia }} mmHg {% else %} N/A {% endif %}</li>
        <li>Temperature: {{ triage.temperature|default:"N/A" }} °C</li>
        <li>Pulse: {{ triage.pr|default:"N/A" }} bpm</li>
        <li>SpO₂: {{ triage.spo2|default:"N/A" }} %</li>
        <li>RBS: {{ triage.rbs|default:"N/A" }} mmol/L</li>
        <li>Height: {{ triage.height|default:"N/A" }} cm</li>
        <li>Weight: {{ triage.weight|default:"N/A" }} kg</li>
        <li>BMI: {{ triage.bmi|default:"N/A" }} ({{ triage.bmi_category }})</li>
      </ul>
    {% else %}
      <p class="text-sm text-gray-500">No triage data available for this visit.</p>
    {% endif %}
  </div>

  <!-- Previous Visits Dropdown -->
  <div class="mt-4 border-t pt-4">
    <button id="toggleVisits" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 focus:outline-none">
      Show Previous Visits
    </button>
    <ul id="previousVisits" class="mt-2 space-y-1 hidden">
      {% for prev in previous_visits %}
        <li>
          <span class="text-gray-700 text-sm">
            {{ prev.date_time|date:"d M Y" }} - {{ prev.get_type_display }}
          </span>
        </li>
      {% empty %}
        <li class="text-gray-500 text-sm">No previous visits found.</li>
      {% endfor %}
    </ul>
  </div>
</div>

<!-- Toggle Script -->
<script>
  const toggleBtn = document.getElementById('toggleVisits');
  const visitsList = document.getElementById('previousVisits');

  toggleBtn.addEventListener('click', () => {
    visitsList.classList.toggle('hidden');
    toggleBtn.textContent = visitsList.classList.contains('hidden') 
      ? 'Show Previous Visits' 
      : 'Hide Previous Visits';
  });
</script>
