{% extends "base.html" %}
{% block content %}

<div class="max-w-8xl mt-12 mx-auto bg-white shadow-md rounded-lg p-6 space-y-8">

  <!-- Header -->
  <div class="flex items-center justify-between">
    <div>
      <h1 class="text-3xl font-bold text-gray-800">Petty Cash Journal</h1>
      <p class="text-sm text-gray-500 mt-1">Track petty cash inflows and outflows</p>
    </div>
    <button id="openModalBtn"
      class="bg-blue-600 text-white px-5 py-2.5 rounded-md text-sm font-medium hover:bg-blue-700 transition">
      + Add Entry
    </button>
  </div>

  <!-- Modal Form -->
  <div id="addEntryModal" class="fixed inset-0 z-50 hidden bg-black bg-opacity-50 items-center justify-center">
    <div class="bg-white w-full max-w-xl rounded-lg shadow-lg p-6 relative">
      <h2 class="text-lg font-bold mb-4 text-gray-800">Add Petty Cash Entry</h2>
      <form method="post" action="{% url 'add_petty_cash_entry' %}">
        {% csrf_token %}
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="text-sm text-gray-600">Date</label>
            <input type="date" name="date" required class="w-full border rounded px-3 py-2">
          </div>
          <div>
            <label class="text-sm text-gray-600">Amount</label>
            <input type="number" step="0.01" name="amount" required class="w-full border rounded px-3 py-2">
          </div>
          <div>
            <label class="text-sm text-gray-600">Paid To</label>
            <input type="text" name="paid_to" required class="w-full border rounded px-3 py-2">
          </div>
          <div>
            <label class="text-sm text-gray-600">Approved By</label>
            <select name="approved_by" class="select2 w-full border rounded px-3 py-2" required>
              <option value="">Select approver</option>
              {% for user in users %}
                <option value="{{ user.get_full_name }}">{{ user.get_full_name }}</option>
              {% endfor %}
            </select>
          </div>
          <div>
            <label class="text-sm text-gray-600">Received By</label>
            <select name="received_by" class="select2 w-full border rounded px-3 py-2">
              <option value="">Select receiver</option>
              {% for user in users %}
                <option value="{{ user.get_full_name }}">{{ user.get_full_name }}</option>
              {% endfor %}
            </select>
          </div>
          <div>
            <label class="text-sm text-gray-600">Reference</label>
            <input type="text" name="reference" class="w-full border rounded px-3 py-2">
          </div>
          <div>
            <label class="text-sm text-gray-600">Entry Type</label>
            <select name="entry_type" required class="w-full border rounded px-3 py-2">
              <option value="">Select</option>
              <option value="debit">Debit (Cash In)</option>
              <option value="credit">Credit (Cash Out)</option>
            </select>
          </div>
          <div class="col-span-2">
            <label class="text-sm text-gray-600">Description</label>
            <textarea name="description" required class="w-full border rounded px-3 py-2"></textarea>
          </div>
        </div>

        <div class="mt-6 flex justify-end gap-4">
          <button type="button" id="cancelModalBtn"
            class="bg-gray-300 text-gray-800 px-4 py-2 rounded hover:bg-gray-400">Cancel</button>
          <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Save</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Table -->
  <div class="overflow-x-auto">
    <table class="min-w-full border text-sm text-gray-800 mt-6">
      <thead class="bg-blue-600 text-white">
        <tr>
          <th class="py-2 px-3 border">Voucher</th>
          <th class="py-2 px-3 border">Date</th>
          <th class="py-2 px-3 border">Paid To</th>
          <th class="py-2 px-3 border">Approved By</th>
          <th class="py-2 px-3 border">Amount</th>
          <th class="py-2 px-3 border">Type</th>
          <th class="py-2 px-3 border">Done By</th>
          <th class="py-2 px-3 border text-center">Action</th>
        </tr>
      </thead>
      <tbody>
        {% for entry in entries %}
        <tr>
          <td class="border px-3 py-2">{{ entry.entry_code }}</td>
          <td class="border px-3 py-2">{{ entry.date }}</td>
          <td class="border px-3 py-2">{{ entry.paid_to }}</td>
          <td class="border px-3 py-2">{{ entry.approved_by }}</td>
          <td class="border px-3 py-2 text-right">{{ entry.amount|floatformat:2 }}</td>
          <td class="border px-3 py-2 capitalize">{{ entry.entry_type }}</td>
          <td class="border px-3 py-2">{{ entry.done_by.get_full_name }}</td>
          <td class="border px-3 py-2 text-center">
            <a href="{% url 'view_petty_cash_entry' entry.id %}" class="text-blue-600 hover:underline text-sm">View</a>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="8" class="text-center py-4 text-gray-500">No entries found.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Back Button -->
  <div class="mt-6 text-center">
    <a href="{% url 'accounting' %}">
      <button type="button"
        class="px-5 py-2.5 rounded-lg text-sm tracking-wider font-semibold border-2 border-gray-700 bg-transparent hover:bg-gray-700 hover:text-white transition-all duration-300">
        Back
      </button>
    </a>
  </div>

</div>

<!-- Scripts -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<script>
  const openModalBtn = document.getElementById("openModalBtn");
  const cancelModalBtn = document.getElementById("cancelModalBtn");
  const modal = document.getElementById("addEntryModal");

  openModalBtn.addEventListener("click", () => {
    modal.classList.remove("hidden");
    modal.classList.add("flex");
  });

  cancelModalBtn.addEventListener("click", () => {
    modal.classList.add("hidden");
    modal.classList.remove("flex");
  });

  window.addEventListener("click", function (e) {
    if (e.target === modal) {
      modal.classList.add("hidden");
      modal.classList.remove("flex");
    }
  });

  $(document).ready(function () {
    $('.select2').select2({ width: '100%' });
  });
</script>

{% endblock %}
