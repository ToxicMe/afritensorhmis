{% extends "base.html" %}
{% block content %}

<div class="overflow-x-auto mt-6">
    <table id="ledgerTable" class="min-w-full border text-sm text-gray-800">
        <thead class="bg-blue-600 text-white">
            <tr>
                <th class="py-2 px-3 border">No</th>
                <th class="py-2 px-3 border">Ledger Account</th>
                <th class="py-2 px-3 border text-right">Debit</th>
                <th class="py-2 px-3 border text-right">Credit</th>
                <th class="py-2 px-3 border text-right">Balance</th>
                <th class="py-2 px-3 border text-center">Action</th>
            </tr>
        </thead>
        <tbody>
            {% for acc in accounts %}
            <tr>
                <td class="border px-3 py-2">{{ acc.account_number }}</td>
                <td class="border px-3 py-2">{{ acc.name }} ({{ acc.currency }})</td>
                <td class="border px-3 py-2 text-right debit">{{ acc.total_debit|default:0|floatformat:2 }}</td>
                <td class="border px-3 py-2 text-right credit">{{ acc.total_credit|default:0|floatformat:2 }}</td>
                <td class="border px-3 py-2 text-right computed-balance">0.00</td>
                <td class="border px-3 py-2 text-center"><a href="#">View</a></td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="6" class="text-center py-4 text-gray-500">No accounts found.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const table = document.getElementById('ledgerTable');

    table.querySelectorAll('tbody tr').forEach(row => {
        const debitCell = row.querySelector('.debit');
        const creditCell = row.querySelector('.credit');
        const balanceCell = row.querySelector('.computed-balance');

        const debit = parseFloat(debitCell.textContent.replace(/,/g, '')) || 0;
        const credit = parseFloat(creditCell.textContent.replace(/,/g, '')) || 0;

        const balance = debit - credit;
        balanceCell.textContent = balance.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });

        // Optional: highlight negative balances in red
        if(balance < 0){
            balanceCell.classList.add('text-red-600', 'font-bold');
        }
    });
});
</script>

{% endblock %}
