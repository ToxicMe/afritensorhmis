{% extends "base.html" %}
{% block content %}
<section class="max-w-6xl mx-auto p-6">
<h2 class="text-2xl font-bold mb-4 text-center">Visits Overview</h2>

  <!-- Dropdown to select period -->
  <form method="get" class="mb-6">
    <label for="period" class="mr-2 font-medium">Select Period:</label>
    <select name="period" id="period" onchange="this.form.submit()" class="border px-2 py-1 rounded">
      <option value="day" {% if selected_period == "day" %}selected{% endif %}>Daily</option>
      <option value="week" {% if selected_period == "week" %}selected{% endif %}>Weekly</option>
      <option value="month" {% if selected_period == "month" %}selected{% endif %}>Monthly</option>
      <option value="year" {% if selected_period == "year" %}selected{% endif %}>Yearly</option>
    </select>
  </form>

  <div class="flex flex-col lg:flex-row gap-6">
    <!-- Bar Chart Section -->
    <div class="flex-1">
      <!-- Total visits legend -->
      <div class="mb-2 text-lg font-medium text-gray-700">
        Total Visits: <span id="totalVisits">0</span>
      </div>
      <canvas id="visitsChart" class="w-full h-96"></canvas>
    </div>

    <!-- Pie Chart Section -->
    <div class="w-full lg:w-1/3">
      <canvas id="genderChart" class="w-full h-64"></canvas>
    </div>
  </div>
</section>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Bar chart for visits
const ctxBar = document.getElementById('visitsChart').getContext('2d');
const barLabels = {{ labels|safe }};
const barCounts = {{ counts|safe }};
document.getElementById('totalVisits').textContent = barCounts.reduce((a, b) => a + b, 0);

const visitsChart = new Chart(ctxBar, {
    type: 'bar',
    data: {
        labels: barLabels,
        datasets: [{
            label: 'Number of Visits',
            data: barCounts,
            backgroundColor: 'rgba(37, 99, 235, 0.7)',
            borderColor: 'rgba(37, 99, 235, 1)',
            borderWidth: 1
        }]
    },
    options: {
        responsive: true,
        scales: {
            y: { beginAtZero: true, precision: 0 },
        },
    }
});

// Pie chart for gender distribution
const ctxPie = document.getElementById('genderChart').getContext('2d');
const genderChart = new Chart(ctxPie, {
    type: 'pie',
    data: {
        labels: {{ gender_labels|safe }},
        datasets: [{
            data: {{ gender_counts|safe }},
            backgroundColor: [
                'rgba(37, 99, 235, 0.7)',   // Male
                'rgba(236, 72, 153, 0.7)',  // Female
                'rgba(249, 115, 22, 0.7)'   // Other
            ],
            borderColor: [
                'rgba(37, 99, 235, 1)',
                'rgba(236, 72, 153, 1)',
                'rgba(249, 115, 22, 1)'
            ],
            borderWidth: 1
        }]
    },
    options: {
        responsive: true,
        plugins: {
            tooltip: {
                callbacks: {
                    label: function(context) {
                        const label = context.label || '';
                        const value = context.raw;
                        const total = context.chart._metasets[0].total;
                        const percentage = ((value / total) * 100).toFixed(1);
                        return `${label}: ${value} (${percentage}%)`;
                    }
                }
            },
            legend: {
                position: 'bottom',
            }
        }
    }
});
</script>
{% endblock %}
